<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shop Well - Wellness Analysis</title>
  <link rel="stylesheet" href="design-tokens.css">
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div id="shop-well-sidepanel">
    <!-- Header -->
    <header class="shop-well-header">
      <div class="shop-well-logo">
        <img src="../assets/navicon2border.png" alt="Shop Well" class="shop-well-icon">
        <span class="shop-well-title">Shop Well</span>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="shop-well-content">

      <!-- Loading State -->
      <div class="shop-well-loading hidden">
        <div class="loading-spinner"></div>
        <p>Analyzing product with Chrome AI...</p>
        <small>This may take a few seconds</small>

        <!-- Timeout warning (shown after 10 seconds) -->
        <div class="loading-timeout-warning hidden">
          <p>‚è±Ô∏è Taking longer than expected...</p>
          <small>AI models may still be downloading. Check <a href="chrome://on-device-internals" target="_blank">model status</a></small>
        </div>

        <!-- Cancel button -->
        <button class="cancel-analysis-button" id="cancelAnalysis">
          Cancel Analysis
        </button>
      </div>

      <!-- Setup Instructions State -->
      <div class="shop-well-setup hidden">
        <div class="setup-icon">‚öôÔ∏è</div>
        <h2>Chrome AI Setup Required</h2>
        <p>Enable Chrome's Built-in AI for enhanced wellness analysis:</p>
        <ol>
          <li>
            <strong>Enable AI Flags:</strong>
            <ul>
              <li>
                <button class="copy-link" data-url="chrome://flags/#optimization-guide-on-device-model" title="Copy to clipboard">
                  optimization-guide-on-device-model
                </button>
              </li>
              <li>
                <button class="copy-link" data-url="chrome://flags/#prompt-api-for-gemini-nano" title="Copy to clipboard">
                  prompt-api-for-gemini-nano
                </button>
              </li>
              <li>
                <button class="copy-link" data-url="chrome://flags/#summarization-api-for-gemini-nano" title="Copy to clipboard">
                  summarization-api-for-gemini-nano
                </button>
              </li>
            </ul>
          </li>
          <li><strong>Restart Chrome</strong> completely (Cmd+Q on Mac, fully quit on Windows)</li>
          <li><strong>Wait 2-3 minutes</strong> for AI models to download</li>
          <li><strong>Return here</strong> and click the button below</li>
        </ol>

        <button class="retry-button" id="checkAIButton">
          Check AI Availability
        </button>

        <div class="setup-note">
          <p><strong>Requirements:</strong></p>
          <ul>
            <li>Chrome 128+ (Stable)</li>
            <li>22 GB free storage for AI models</li>
            <li>4+ GB VRAM (GPU memory)</li>
          </ul>
          <p>
            <a href="chrome://on-device-internals" target="_blank" class="external-link">
              Check AI model status ‚Üí
            </a>
          </p>
        </div>
      </div>

      <!-- AI Analysis Results State -->
      <div class="shop-well-analysis hidden">
        <div class="product-info">
          <h3 class="product-title"></h3>
          <div class="product-meta">
            <span class="product-price"></span>
            <span class="product-rating"></span>
          </div>
        </div>

        <div class="analysis-header">
          <div class="verdict-badge"></div>
          <div class="condition-info"></div>
        </div>

        <div class="analysis-content">
          <!-- Key Insights -->
          <section class="key-insights">
            <h4>üîç Key Insights</h4>
            <div class="insights-content"></div>
          </section>

          <!-- Allergen Alerts -->
          <section class="allergen-alerts hidden">
            <h4>üö® Allergen Alert</h4>
            <div class="alert-content"></div>
          </section>

          <!-- Important Caveat -->
          <section class="important-caveat hidden">
            <h4>‚ö†Ô∏è Important</h4>
            <div class="caveat-content"></div>
          </section>
        </div>

        <!-- Chat Interface -->
        <div class="chat-section">
          <div class="chat-header">
            <h4>üí¨ Ask Questions</h4>
            <p class="chat-subtitle">Ask anything about this product for your condition</p>
          </div>

          <div class="chat-messages" id="chatMessages"></div>

          <div class="chat-input-container">
            <input
              type="text"
              id="chatInput"
              class="chat-input"
              placeholder="e.g., 'How much sodium is too much?' or 'Can I eat this daily?'"
              maxlength="200"
            />
            <button id="chatSendButton" class="chat-send-button" title="Send message">
              <span>‚û§</span>
            </button>
          </div>

          <div class="chat-loading hidden" id="chatLoading">
            <div class="chat-loading-dots">
              <span></span><span></span><span></span>
            </div>
            <small>AI is thinking...</small>
          </div>
        </div>
      </div>

      <!-- Error State -->
      <div class="shop-well-error hidden" role="alert">
        <div class="error-icon">‚ö†Ô∏è</div>
        <h2>Analysis Failed</h2>
        <p class="error-message"></p>
        <button class="retry-button" id="retryAnalysis">Try Again</button>
      </div>

      <!-- Welcome State (shown when no product page active) -->
      <div class="shop-well-welcome">
        <div class="welcome-icon">üåø</div>
        <h2>Welcome to Shop Well</h2>
        <p>Your wellness-friendly shopping companion!</p>

        <div class="welcome-instructions">
          <p><strong>To get started:</strong></p>
          <ol>
            <li>Visit an Amazon or Walmart product page</li>
            <li>Press <kbd>‚å•‚áßW</kbd> (Mac) or <kbd>Alt+Shift+W</kbd> (Windows/Linux)</li>
            <li>Get instant wellness analysis powered by Chrome AI</li>
          </ol>
        </div>

        <div class="welcome-features">
          <h3>Features:</h3>
          <ul>
            <li>‚úÖ AI-powered ingredient analysis</li>
            <li>‚úÖ Personalized wellness recommendations</li>
            <li>‚úÖ Allergen detection and warnings</li>
            <li>‚úÖ 100% private, on-device processing</li>
          </ul>
        </div>

        <a href="chrome-extension://EXTENSION_ID/options/index.html" class="settings-link" id="settingsLink">
          ‚öôÔ∏è Configure Your Settings
        </a>
      </div>

    </main>

    <!-- Footer -->
    <footer class="shop-well-footer">
      <p class="disclaimer">
        <small>‚ÑπÔ∏è Informational only - not medical advice. Always verify ingredients yourself.</small>
      </p>
      <p class="ai-badge">
        <small>‚ö° Powered by Chrome Built-in AI (Gemini Nano)</small>
      </p>
    </footer>
  </div>

  <script src="sidepanel.js"></script>
</body>
</html>
